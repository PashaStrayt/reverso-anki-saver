# Reverso to Anki Saver

Userscript –¥–ª—è Tampermonkey, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫—É "Add to Anki" –Ω–∞ –∫–∞–∂–¥—É—é –∫–∞—Ä—Ç–æ—á–∫—É —Å–ª–æ–≤–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Reverso Dictionary –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ Anki —á–µ—Ä–µ–∑ AnkiConnect.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Anki Desktop** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
2. **AnkiConnect** addon —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Anki ([—Å–∫–∞—á–∞—Ç—å](https://ankiweb.net/shared/info/2055492159))
3. **Tampermonkey** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
yarn install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `src/config.ts`:

- `deckName`: –∏–º—è —Ç–≤–æ–µ–π –∫–æ–ª–æ–¥—ã –≤ Anki
- `modelName`: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–≤–æ–µ–≥–æ Note Type
- `fieldMapping`: –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ Reverso –≤ –ø–æ–ª—è —Ç–≤–æ–µ–≥–æ Note Type
- `minWidthPx`: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç –¥—Ä—É–≥–∏—Ö –ª–µ–π–∞—É—Ç–æ–≤)

### 3. –°–±–æ—Ä–∫–∞

```bash
# Dev-—Ä–µ–∂–∏–º —Å watch
yarn dev

# Production —Å–±–æ—Ä–∫–∞
yarn build
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ Tampermonkey

1. –û—Ç–∫—Ä–æ–π Tampermonkey Dashboard
2. Utilities ‚Üí Install from file
3. –í—ã–±–µ—Ä–∏ `dist/reverso-anki-saver.user.js`
4. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π —ç—Ç–æ—Ç —Ñ–∞–π–ª –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî Tampermonkey –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–∏–ø–∞ `https://dictionary.reverso.net/english-definition/:word#translation=russian`
2. –†—è–¥–æ–º —Å –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ **"+ Add to Anki"**
3. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ Anki
4. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ü–∞—Ä—Å–∏—Ç —Å–ª–æ–≤–æ, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ—Ä—ã
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
   - –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–≥–∏: `reverso`, `reverso::english-definition`, `needs_tts`
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—Å—Ç—ã —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

## Dev Workflow —Å Hot-Reload

**–ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ dev mode** (–æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å—ë):
```bash
yarn dev
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç:
- üì¶ Watch mode –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
- üì¶ Watch mode –¥–ª—è loader-—Å–∫—Ä–∏–ø—Ç–∞
- üåê Dev server –Ω–∞ `http://127.0.0.1:7744/`

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ loader –æ–¥–∏–Ω —Ä–∞–∑:**
   - Tampermonkey Dashboard ‚Üí Utilities ‚Üí Import from file
   - –í—ã–±–µ—Ä–∏—Ç–µ: `dist/loader-dev.user.js`
   - –ù–∞–∂–º–∏—Ç–µ "Install"

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º:**
1. –ú–µ–Ω—è–π—Ç–µ –∫–æ–¥ –≤ `src/`
2. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ (Cmd+S)
3. –î–æ–∂–¥–∏—Ç–µ—Å—å `[0] built in XXms` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
4. **–ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ F5** –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Reverso
5. Loader –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç —Å–≤–µ–∂–∏–π –∫–æ–¥ —Å —Å–µ—Ä–≤–µ—Ä–∞!

Build timestamp –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–∫–∞–∂–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–±–æ—Ä–∫–∏.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
  index.ts              # Main userscript entry point
  loader.ts             # Dev hot-reload loader
  config.ts             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (deck, model, –ø–æ–ª—è)
  types.ts              # TypeScript —Ç–∏–ø—ã
  vite-env.d.ts         # Vite type declarations
  anki/
    ankiConnect.ts      # –ö–ª–∏–µ–Ω—Ç –¥–ª—è AnkiConnect API
  reverso/
    observe.ts          # –ü–æ–∏—Å–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ + –∏–Ω—ä–µ–∫—Ü–∏—è –∫–Ω–æ–ø–æ–∫
    parseCard.ts        # –ü–∞—Ä—Å–∏–Ω–≥ DOM –∫–∞—Ä—Ç–æ—á–∫–∏
  ui/
    toast.ts            # –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

dist/                   # –°–æ–±—Ä–∞–Ω–Ω—ã–µ userscripts (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
  dev.reverso-anki-saver.user.js    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç (dev)
  loader-dev.user.js                 # Loader –¥–ª—è hot-reload (dev)
  reverso-anki-saver.user.js        # Production —Å–∫—Ä–∏–ø—Ç (–ø–æ—Å–ª–µ yarn build)
```

## –í–∞–∂–Ω–æ

### –°–µ–ª–µ–∫—Ç–æ—Ä—ã DOM

**TODO:** –ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ `src/reverso/parseCard.ts` –∏ `src/reverso/observe.ts` –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É DOM –Ω–∞ Reverso. –°–µ–π—á–∞—Å —Ç–∞–º placeholder-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã.

### –ë—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã

–°–∫—Ä–∏–ø—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ —à–∏—Ä–∏–Ω–µ >= 768px. –ï—Å–ª–∏ –ø–æ–ø—ã—Ç–∞–µ—à—å—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –Ω–∞ —É–∑–∫–æ–º —ç–∫—Ä–∞–Ω–µ ‚Äî –ø–æ–ª—É—á–∏—à—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ. –≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ª–µ–π–∞—É—Ç–∞.

### Future: HyperTTS

–°–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–≥ `needs_tts` –∫ –∫–∞–∂–¥–æ–π –∑–∞–º–µ—Ç–∫–µ. –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ:
- –í—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å HyperTTS –ø–æ —ç—Ç–æ–º—É —Ç–µ–≥—É
- –°–æ–∑–¥–∞—Ç—å Anki addon-bridge –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ

## Troubleshooting

**"AnkiConnect not available"**
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ Anki –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ AnkiConnect —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—Ç–∫—Ä–æ–π `http://127.0.0.1:8765` –≤ –±—Ä–∞—É–∑–µ—Ä–µ)

**"Deck/Note Type not found"**
- –ü—Ä–æ–≤–µ—Ä—å –Ω–∞–∑–≤–∞–Ω–∏—è –≤ `src/config.ts`
- –ù–∞–∑–≤–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å (—Å —É—á—ë—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞)

**"Parse failed"**
- –û–±–Ω–æ–≤–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –≤ `src/reverso/parseCard.ts` –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–æ–≤–µ—Ä—å console –≤ DevTools –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
